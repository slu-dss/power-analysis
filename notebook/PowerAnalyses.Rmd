---
title: "Power Analyses"
output: 
  html_document:
    css: SLUCOR.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "")
```

## Package `pwr`

The `pwr` package is a handy package for doing power analyses for various common statistical procedures. This is not a standard R package, so you will need to install it before you run it. You only have to install it once, so I'm  actually "hiding" this chunk from running atuomatically by setting the chunk option `eval = F`. The only way this chunk runs is if I specifically put my cursor in it and tell it to run manually. You will need to do likewise, but only once. 

```{r, eval=F}
install.packages("pwr")
```

Now that it is installed, you can load the package to make it ready to use.
```{r}
library(pwr)
```

## t-test examples


### One-sample t-test
First, we will start with an example where we know the sample size, but would like to know the power.
```{r}
swimmers <- read.csv("swimmers.csv")
t.test(swimmers$speed, mu = 1)
pwr.t.test(n = dim(swimmers)[1], 
           d = mean(swimmers$speed) - 1, 
           sig.level = 0.05, 
           type = "one.sample", 
           alternative = "two.sided")
```

Our power was only 0.05. How many swimmers would we have needed to measure in order to detect a difference (d = 0.01) this small at a stronger power, say 0.9? We simply leave out whatever parameter we want to estimate.
```{r}
pwr.t.test(power = 0.9, 
           d = mean(swimmers$speed) - 1, 
           sig.level = 0.05, 
           type = "one.sample", 
           alternative = "two.sided")
```

That's a lot of swimmers.

### Two-sample t-test

Let's do the same for a two-sample t-test:
```{r}
energy <- read.csv("energy.csv")
energy.t <- t.test(energy$expend~energy$stature)
pwr.t.test(n = dim(energy)[1], 
           d = diff(tapply(energy$expend, energy$stature, mean)), 
           sig.level = 0.05, 
           type = "two.sample", 
           alternative = "two.sided")
pwr.t.test(power = 0.9, 
           d = diff(tapply(energy$expend, energy$stature, mean)), 
           sig.level = 0.05, 
           type = "two.sample", 
           alternative = "two.sided")
```

### Paired t-test
Here, we apply the same idea to a paird t-test example.

```{r}
intake <- read.csv("intake.csv")
t.test(intake$pre, intake$post, paired = T)
pwr.t.test(n = dim(intake)[1], 
           d = mean(intake$pre-intake$post), 
           sig.level = 0.05, 
           type = "two.sample", 
           alternative = "two.sided")
```

## ANOVA power analysis
Here we try to determine $\beta$ from `pwr.anova.test()` on the jetlag data.
```{r}
jetlag <- read.csv("jetlag.csv")
(phase <- summary(aov(phaseshift ~ treatment, data = jetlag)))
pwr.anova.test(k = 3,
               n = dim(jetlag)[1],
               f = phase[[1]][1, 4],
               sig.level = 0.05)
```

## Regression
Here we try to determine $\beta$ for a regression model.
```{r}
thuesen <- read.csv("thuesen.csv")
summary(thuesen.lm <- lm(short.velocity ~ blood.glucose, data = thuesen))
pwr.f2.test(u = anova(thuesen.lm)[1, 1],
            v = anova(thuesen.lm)[2, 1],
            f2 = summary(thuesen.lm)$r.squared/(1-summary(thuesen.lm)$r.squared))
```

To have achieved a power of 0.9 (irrelevant since we actualy did find significance, but let's pretend this was a pilot study), we would need to collet how many samples?
```{r}
pwr.f2.test(u = anova(thuesen.lm)[1, 1],
            power = 0.9,
            f2 = summary(thuesen.lm)$r.squared/(1-summary(thuesen.lm)$r.squared))
```

We would need to measure 50 + 1 cells.